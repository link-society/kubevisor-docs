<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Kubirds - Persistent Volume</title><meta name=author content="Link-Society"><meta name=title content="Kubirds"><meta name=description content="Dockerized supervision on Kubernetes"><meta name=og:title content="Kubirds"><meta name=og:description content="Dockerized supervision on Kubernetes"><meta name=og:logo content="/gfx/Logo_Kubirds.png"><meta name=twitter:title content="Kubirds"><link rel=icon type=image/svg href=/gfx/Favicon_Kubirds.svg><link rel=stylesheet id=google-fonts-css href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;700&family=Roboto:wght@300;400;500;700&display=swap" type=text/css media=all><link rel=stylesheet id=main-css href=/css/style.css type=text/css media=all><link rel=stylesheet id=main-css href=/css/tabs.css type=text/css media=all><link rel=stylesheet id=main-css href=/css/tutorial-link.css type=text/css media=all><script type=text/javascript src=/js/jquery-3.5.0.min.js></script><script type=text/javascript src=/js/showdown.min.js></script><script type=text/javascript src=/js/highcharts.js></script><script type=text/javascript src=/js/highcharts-more.js></script><script type=text/javascript>function send_contact(a){const b=$(a).serialize();$.ajax({type:'POST',url:"https://hooks.zapier.com/hooks/catch/7255418/ow4b2ez/silent/",data:b}).then(()=>{parent.jQuery.fancybox.getInstance().close()})}</script><script type=application/javascript>$(function(){const a=$('.embed-tabs');a.find($('nav .ul .li a')).click(function(){const b=$(this),c=b.data('ref');a.find($('nav .ul .li')).removeClass('is-active'),b.parent().addClass('is-active'),a.find($('.content .tab')).removeClass('is-active'),a.find($(`.content .tab[data-ref='${c}']`)).addClass('is-active')}),a.map((c,b)=>{const a=$(b);$(a.find($('nav .ul .li'))[0]).addClass('is-active'),$(a.find($('.content .tab'))[0]).addClass('is-active')})})</script><script type=application/javascript>window.BaseWebComponent={extends({tag:a,template:b,render:c}){customElements.define(a,class extends HTMLElement{connectedCallback(){const a=document.getElementById(b),d=document.importNode(a.content,!0);$(this).append(d),c($(this))}})}}</script></head><body><header><div class=header><div class=hTop><div class=content><nav><div class=hSms id=hSms><span></span><span></span></div><h1><a href=/ class=hLogo><img src=/gfx/Logo_Kubirds.png alt=Kubirds></a></h1><ul class="hNavSec noNav" id=hNavSec><li class=hNavSNoFix><a href=https://kubernetes.io><img src=/gfx/Logo_Kubernetes.svg alt=Kubernetes></a></li><li><a data-fancybox data-type=iframe href=/contact>Contact</a></li><li><a href=/about>About us</a></li><li><a href=/legals>Legals</a></li><li class=hNavSNoFix><a href=https://github.com/link-society target=_blank><img src=/gfx/Logo_Github.svg alt=Github></a></li></ul></nav></div></div><div class="hMenu noNav" id=hMenu><div class=content><nav><ul class=hNav><li><a href=/getting-started>Getting Started</a></li><li><a href=/products>Products and Services</a></li><li><a href=/docs/>Documentation</a></li></ul></nav></div></div></div></header><section><div class=mainContent><div class=content><nav><ul class=navInterne><li><a href=/docs/dockerized-supervision/data/><i class=icon-mdi_navigate_before></i></a></li></ul></nav><h1><a href=/docs/>ðŸ“š</a> /
<a href=/docs/dockerized-supervision/>Dockerized Supervision</a> /
<a href=/docs/dockerized-supervision/data/>Data Oriented</a> /
Persistent Volume</h1><h2>Share data between your units and reactors</h2><div class=dispos><div class=dispoCol><ul class=colMenu><li class=act><span>Persistent Volume</span></li><li><a href=/docs/dockerized-supervision/data/access/>Data Access</a></li></ul></div><div class=contenu><h1 id=use-case>Use Case</h1><a href=/docs/dockerized-supervision/data/ class="tutorial-link tutorial-come-from"><span>&#8592; Consider reading first</span>
<span class=tutorial-next-page>Data Oriented</span></a><p>You have a Docker image <code>example/test-suite:latest</code> providing a command <code>run-test-suite</code>.</p><p>The command produce a <a href=https://junit.org/junit5/>JUnit</a> report to <code>/tmp/report.xml</code>.</p><p>You have a webhook accepting <em>JUnit</em> reports for further business logic.</p><h1 id=how-to>How-To</h1><p>First, create a persistent volume to store your report:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PersistentVolumeClaim</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-testsuite-workspace-pvc</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>storageClassName</span>: <span style=color:#ae81ff>default</span>
  <span style=color:#f92672>accessModes</span>:
    - <span style=color:#ae81ff>ReadWriteOnce</span>
    - <span style=color:#ae81ff>ReadOnly</span>
  <span style=color:#f92672>resources</span>:
    <span style=color:#f92672>requests</span>:
      <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>10Mi</span>
</code></pre></div><p>Then mount the volume on your unit:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kubirds.com/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Unit</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-testsuite</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
  <span style=color:#f92672>labels</span>:
    <span style=color:#f92672>publish-junit-report</span>: <span style=color:#e6db74>&#34;yes&#34;</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>schedule</span>: <span style=color:#e6db74>&#34;every day&#34;</span>
  <span style=color:#f92672>image</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>example/test-suite:latest</span>
    <span style=color:#f92672>command</span>: <span style=color:#e6db74>&#34;run-test-suite -o /tmp/report.xml&#34;</span>
    <span style=color:#f92672>pullPolicy</span>: <span style=color:#ae81ff>Always</span>
  <span style=color:#f92672>volumes</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>workspace</span>
      <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/tmp</span>
      <span style=color:#f92672>persistentVolumeClaim</span>:
        <span style=color:#f92672>claimName</span>: <span style=color:#ae81ff>my-testsuite-workspace-pvc</span>
</code></pre></div><p>And finally, mount the volume on your reactor:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kubirds.com/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Reactor</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>junit-publisher</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>unitSelector</span>:
    <span style=color:#f92672>publish-junit-report</span>: <span style=color:#e6db74>&#34;yes&#34;</span>
  <span style=color:#f92672>image</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>curlimages/curl:latest</span>
    <span style=color:#f92672>command</span>: <span style=color:#e6db74>&#34;curl -X POST -d @/tmp/report.xml $HOST&#34;</span>
    <span style=color:#f92672>pullPolicy</span>: <span style=color:#ae81ff>Always</span>
  <span style=color:#f92672>env</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>HOST</span>
      <span style=color:#f92672>value</span>: <span style=color:#ae81ff>https://api.example.com/junit-report/</span>
  <span style=color:#f92672>volumes</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>workspace</span>
      <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/tmp</span>
      <span style=color:#f92672>persistentVolumeClaim</span>:
        <span style=color:#f92672>claimName</span>: <span style=color:#ae81ff>my-testsuite-workspace-pvc</span>
        <span style=color:#f92672>readOnly</span>: <span style=color:#66d9ef>yes</span>
</code></pre></div><p><strong>NB:</strong> In this example, we used a <code>PersistentVolumeClaim</code> but any volume that could be used for a <code>Pod</code> can be used here.</p><a href=/docs/dockerized-supervision/data/access/ class=tutorial-link><span>Continue reading &#8594;</span>
<span class=tutorial-next-page>Data Access</span></a></div></div></div></div></section><footer><div class=footer><p>Website content is released under the terms of the
<a href=http://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY NC SA 4.0</a>
license.</p></div></footer><script type=text/javascript src=/js/scripts.js></script></body></html>